<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Client</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
   <link rel="stylesheet" href="css/client.css">
</head>
<body>
    <!-- Barre de navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">Rendez-vous</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="#mesrendezvous">Mes Rendez-vous</a></li>
                    <li class="nav-item"><a class="nav-link" href="/profile">Profil</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Section de recherche -->
    <div class="search-box">
        <h2>Rechercher un professionnel</h2>
        <input type="text" id="searchInput" placeholder="Rechercher un professionnel (ex: Médecin, Avocat)">
        <button onclick="rechercherProfessionnel()" class="btn btn-primary mt-2">Rechercher</button>
    </div>

    <!-- Spinner de chargement -->
    <div id="loadingSpinner" class="d-none">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Chargement...</span>
        </div>
    </div>

    <!-- Section des résultats -->
    <div class="results-section d-none" id="resultsSection">
        <h3>Résultats de la recherche</h3>
        <table>
            <thead>
                <tr>
                    <th>Nom</th>
                    <th>Métier</th>
                    <th>Localisation</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="resultsBody">
                <!-- Les résultats seront injectés ici par JavaScript -->
            </tbody>
        </table>
    </div>

    <script>
        async function rechercherProfessionnel() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            try {
                // Afficher le spinner
                document.getElementById('loadingSpinner').classList.remove('d-none');

                // Appeler l'API backend
                const response = await fetch(`http://localhost:7000/search-professionals?job=${searchTerm}`);
                const professionals = await response.json();

                // Masquer le spinner
                document.getElementById('loadingSpinner').classList.add('d-none');

                // Afficher les résultats dans le tableau
                const resultsBody = document.getElementById('resultsBody');
                if (professionals.length === 0) {
                    resultsBody.innerHTML = `
                        <tr>
                            <td colspan="4" class="text-center">Aucun professionnel trouvé</td>
                        </tr>
                    `;
                } else {
                    resultsBody.innerHTML = professionals.map(prof => `
                        <tr>
                            <td>${prof.username}</td>
                            <td>${prof.job}</td>
                            <td>${prof.cityAddress}</td>
                            <td><button class="btn btn-primary" onclick="reserver('${prof.username}')">Réserver</button></td>
                        </tr>
                    `).join('');
                }

                // Afficher la section des résultats
                document.getElementById('resultsSection').classList.remove('d-none');
            } catch (error) {
                console.error('Erreur lors de la recherche :', error);
                alert('Une erreur est survenue lors de la recherche.');
                document.getElementById('loadingSpinner').classList.add('d-none');
            }
        }

        function reserver(nom) {
            alert(`Réservation avec ${nom} en cours...`);
            // Ici, vous pouvez ajouter la logique pour réserver un rendez-vous
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>